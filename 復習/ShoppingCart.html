<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Giỏ Hàng</title>
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link
            href="https://fonts.googleapis.com/css2?family=Bungee+Inline&family=Nunito+Sans:wght@400;600;700;800;900&display=swap"
            rel="stylesheet" />
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
            integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
            crossorigin="anonymous" />
        <style>
            *,
            *::before,
            *::after {
                margin: 0;
                padding: 0;
                box-sizing: inherit;
            }

            html {
                font-size: 62.5%;
                box-sizing: border-box;
            }

            body {
                padding: 2rem 4rem;
                line-height: 1.7;
                font-family: 'Nunito Sans', sans-serif;
                color: #555;
                min-height: 100vh;
                background-image: linear-gradient(to bottom right, #67b26f, #4ca2cd);
            }

            img {
                max-width: 100%;
                vertical-align: middle;
                border-radius: 4px;
                margin-right: 10px;
            }

            a {
                text-decoration: none;
                color: #333333;
            }

            a:hover {
                color: #f58551;
            }

            button {
                background-color: #16cc9b;
                border: 2px solid #16cc9b;
                color: #ffffff;
                transition: all 0.25s linear;
                cursor: pointer;
            }

            button::after {
                position: relative;
                right: 0;
                content: ' \276f';
                transition: all 0.15s linear;
            }

            button:hover {
                background-color: #f58551;
                border-color: #f58551;
            }

            button:hover::after {
                right: -5px;
            }

            button:focus {
                outline: none;
            }

            ul {
                padding: 0;
                margin: 0;
                list-style-type: none;
            }

            input {
                transition: all 0.25s linear;
            }

            input[type='number']::-webkit-inner-spin-button,
            input[type='number']::-webkit-outer-spin-button {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                margin: 0;
            }

            input {
                outline: none;
            }

            .thanh-gio-hang {
                width: 90%;
                margin: 0 auto;
                overflow: auto;
            }

            /* --- HEADER --- */
            .tieu-de h1 {
                font-family: 'Bungee Inline', sans-serif;
                font-weight: 400;
                font-size: 3rem;
                color: white;
                margin-bottom: 2rem;
                text-align: center;
                word-spacing: 3px;
            }

            .tieu-de .duong-dan li {
                float: left;
                padding: 0 6px;
            }

            .tieu-de .duong-dan li:first-child {
                padding-left: 2px;
            }

            .tieu-de .duong-dan li:not(:last-child)::after {
                content: ' \276f';
                padding-left: 8px;
            }

            .tieu-de .so-luong {
                float: right;
            }

            /* --- PRODUCT LIST --- */
            .san-pham {
                border-top: 1px solid #ddd;
            }

            .san-pham > li {
                padding: 1rem 0;
                background-color: #fff;
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .dong {
                display: flex;
            }

            .cot.trai {
                flex-basis: 70%;
            }

            .cot.phai {
                flex-basis: 30%;
                display: flex;
                align-items: center;
            }

            .chi-tiet {
                padding: 0 0.5rem;
                line-height: 2.2rem;
            }

            .chi-tiet .ten {
                font-size: 1.2rem;
                font-weight: 700;
            }

            .chi-tiet .mo-ta {
                font-size: 1rem;
                margin: 0.7rem 0;
                line-height: 1.4;
            }

            .chi-tiet .gia {
                font-size: 1.2rem;
                font-weight: 700;
            }

            .so-luong,
            .xoa {
                width: 50%;
                text-align: center;
            }

            .so-luong > input {
                display: inline-block;
                width: 40px;
                height: 40px;
                position: relative;
                left: calc(50% - 30px);
                background: #fff;
                border: 2px solid #ddd;
                border-radius: 50%;
                text-align: center;
                font: 600 1.5rem Helvetica, Arial, sans-serif;
            }

            .so-luong > input:hover,
            .so-luong > input:focus {
                border-color: #f58551;
            }

            .dong .xoa svg {
                width: 40px;
                height: 40px;
            }

            /* --- SUMMARY --- */
            .khuyen-mai,
            .tong-tien,
            .thanh-toan {
                float: left;
                width: 100%;
                margin-top: 1.5rem;
            }

            .khuyen-mai > label {
                float: left;
                width: 100%;
                margin-bottom: 1rem;
            }

            .khuyen-mai > input {
                float: left;
                width: 80%;
                font-size: 1rem;
                padding: 1rem 1.5rem;
                border: 2px solid #16cc9b;
            }

            .khuyen-mai > input:hover {
                border-color: #f58551;
            }

            .khuyen-mai > button {
                float: left;
                width: 20%;
                padding: 1rem 1.5rem;
            }

            .khuyen-mai > button:hover {
                border-color: #f58551;
                background-color: #f58551;
            }

            .khuyen-mai > button::after {
                content: '\276f';
                font-size: 1rem;
            }

            .tong-tien {
                font-size: 1.2rem;
                text-align: right;
            }

            .tong-tien ul li {
                padding: 0.5rem 0;
            }

            .tong-tien ul li span {
                display: inline-block;
                width: 30%;
            }

            .tong-tien ul li.tong-tien-sau-giam-gia {
                font-weight: bold;
            }

            .thong-bao-loi {
                color: darkred;
                font-size: 25px;
            }

            /* --- SMALL SCREEN --- */
            @media all and (max-width: 599px) {
                .thumbnail img {
                    display: none;
                }

                .quantity > input {
                    width: 40px;
                    height: 40px;
                    left: calc(50% - 20px);
                }

                .remove svg {
                    width: 40px;
                    height: 40px;
                }
            }

            /* --- MEDIUM & LARGE SCREEN --- */
            @media all and (min-width: 600px) {
                html {
                    font-size: 14px;
                }

                .container {
                    width: 75%;
                    max-width: 960px;
                }

                .thumbnail,
                .detail {
                    float: left;
                }

                .thumbnail {
                    width: 30%;
                }

                .detail {
                    width: 65%;
                    padding: 0 1rem;
                }

                .promotion,
                .summary {
                    width: 50%;
                }

                .checkout {
                    width: 100%;
                }

                .checkout,
                .summary {
                    text-align: right;
                }
            }

            /* --- LARGE SCREEN --- */
            @media all and (min-width: 992px) {
                html {
                    font-size: 16px;
                }
            }
        </style>
    </head>
    <body>
        <main>
            <header class="container">
                <h1>Giỏ Hàng</h1>
                <ul class="breadcrumb">
                    <li>Trang chủ</li>
                    <li>Giỏ Hàng</li>
                </ul>
                <span class="count">3 sản phẩm trong giỏ hàng</span>
            </header>
            <section class="container">
                <ul class="san-pham" id="san-pham"></ul>
            </section>
            <section class="option-container container">
                <!-- Mã giảm giá -->
                <div class="khuyen-mai">
                    <label for="ma-giam-gia">Có mã giảm giá?</label>
                    <input type="text" id="ma-giam-gia" autocomplete="off" />
                    <button type="button" onclick="apDungMaGiamGia()"></button>
                </div>
                <!-- Tổng tiền -->
                <div class="tong-tien">
                    <ul>
                        <li class="tong-tien-truoc-giam-gia">
                            Tổng tiền trước giảm giá: <span id="tong-tien-truoc-giam-gia_value"></span>
                        </li>
                        <li class="thue-vat">Thuế VAT: <span id="thue-vat_value"></span></li>
                        <li class="giam-gia hide">Giảm giá: <span></span></li>
                        <li class="tong-tien-sau-giam-gia">
                            Tổng tiền sau giảm giá: <span id="tong-tien-sau-giam-gia_value"></span>
                        </li>
                    </ul>
                </div>
            </section>
        </main>
        <script>
            var danhSachSanPham = [
                {
                    id: 1,
                    ten: 'Laptop Asus',
                    moTa: 'Máy tính Asus',
                    gia: 20,
                },
                {
                    id: 2,
                    ten: 'Laptop Acer',
                    moTa: 'Máy tính Acer',
                    gia: 19,
                },
                {
                    id: 3,
                    ten: 'Laptop Dell',
                    moTa: 'Máy tính Dell',
                    gia: 25,
                },
                {
                    id: 4,
                    ten: 'Laptop Logitech',
                    moTa: 'Máy tính Logitech',
                    gia: 22,
                },
            ];

            var maGiamGia = '123456';

            function hienThiGiaoDien() {
                let html = '';
                if (danhSachSanPham.length === 0) {
                    html = ' Chưa có sản phẩm nào trong giỏ hàng';
                } else {
                    for (let i = 0; i < danhSachSanPham.length; i++) {
                        html += `<li class="dong">
                        <div class="cot trai">
                            <div class="thumbnail">
                                <a href="#"><img src="https://via.placeholder.com/200x150" alt="" /></a>
                            </div>
                            <div class="chi-tiet">
                                <div class="ten"><a href="#">${danhSachSanPham[i].ten}</a></div>
                                <div class="mo-ta">${danhSachSanPham[i].moTa}</div>
                                <div class="gia">$${danhSachSanPham[i].gia}</div>
                                <div class="tong-gia" id="gia_${danhSachSanPham[i].id}"></div>
                            </div>
                        </div>
                        <div class="cot phai">
                            <div class="so-luong">
                                <input
                                    type="number"
                                    onkeyup="xuLyThayDoiSoLuong(${danhSachSanPham[i].id}, ${danhSachSanPham[i].gia})"
                                    class="so-luong-san-pham"
                                    id="san-pham_${danhSachSanPham[i].id}" 
                                    step="1" value="1" 
                                />
                            </div>
                            <div class="xoa">
                                <span class="dong"><i class="fa fa-times" aria-hidden="true"></i></span>
                            </div>
                        </div>
                    </li>`;
                    }
                }
                document.getElementById('san-pham').innerHTML = html;
            }
            hienThiGiaoDien();

            function capNhatTongTien() {
                const cacSanPham = document.getElementById('san-pham').children;
                let tongTienTruocGiamGia = 0;
                let thueVAT = 0;
                let giamGia = 0;
                let tongTienSauGiamGia = 0;
                for (let i = 0; i < cacSanPham.length; i++) {
                    const giaTien = parseFloat(cacSanPham[i].querySelector('.gia').textContent.replace('$', ''));
                    const soLuong = parseFloat(cacSanPham[i].querySelector('.so-luong-san-pham').value);
                    tongTienTruocGiamGia += giaTien * soLuong;
                }
                // Tính thuế VAT và cộng vào tổng giá trị
                thueVAT = tongTienTruocGiamGia * 0.1;
                // Tính tổng tiền sau giảm giá và cập nhật giá trị trong phần summary
                tongTienSauGiamGia = tongTienTruocGiamGia + thueVAT;
                document.getElementById(
                    'tong-tien-truoc-giam-gia_value',
                ).textContent = `$${tongTienTruocGiamGia.toFixed(2)}`;
                document.getElementById('thue-vat_value').textContent = `$${thueVAT.toFixed(2)}`;
                document.getElementById('tong-tien-sau-giam-gia_value').textContent = `$${tongTienSauGiamGia.toFixed(
                    2,
                )}`;
            }

            function xuLyThayDoiSoLuong(id, gia) {
                let soLuong = document.getElementById('san-pham_' + id).value;
                if (soLuong <= 0) {
                    document.getElementById('gia_' + id).innerHTML = 'Vui lòng nhập số lượng hợp lệ';
                    return;
                } else {
                    let giaMoi = soLuong * gia;
                    document.getElementById('gia_' + id).innerHTML = '$' + giaMoi;
                }
                capNhatTongTien();
            }

            capNhatTongTien();

            function apDungMaGiamGia() {
                const maGiamGiaNhap = document.getElementById('ma-giam-gia').value;
                const phanGiamGia = document.querySelector('.giam-gia');
                // Kiểm tra nếu mã giảm giá nhập vào đúng
                if (maGiamGiaNhap === maGiamGia) {
                    const tongTienTruocGiamGiaValue = parseFloat(
                        document.getElementById('tong-tien-truoc-giam-gia_value').textContent.replace('$', ''),
                    );
                    const giaTriGiamGia = tongTienTruocGiamGiaValue * 0.05;
                    document.querySelector('.giam-gia span').textContent = `-$${giaTriGiamGia.toFixed(2)}`;
                    phanGiamGia.classList.remove('hide');
                } else {
                    phanGiamGia.classList.add('hide');
                    // Nếu mã giảm giá nhập vào không đúng, hiển thị thông báo lỗi
                    const thongBaoLoiMaGiamGia = 'Mã không đúng hoặc đã hết hạn';
                    const phanTuThongBaoLoiMaGiamGia = document.createElement('span');
                    phanTuThongBaoLoiMaGiamGia.classList.add('thong-bao-loi');
                    phanTuThongBaoLoiMaGiamGia.textContent = thongBaoLoiMaGiamGia;
                    const khuyenMaiContainer = document.querySelector('.khuyen-mai');
                    khuyenMaiContainer.appendChild(phanTuThongBaoLoiMaGiamGia);
                    // Xóa thông báo lỗi sau 3 giây
                    setTimeout(() => {
                        phanTuThongBaoLoiMaGiamGia.remove();
                    }, 3000);
                }
                capNhatTongTien();
            }

            //Nút remove
            document.addEventListener('click', function (event) {
                if (event.target.classList.contains('fa-times')) {
                    const sanPham = event.target.closest('li.dong');
                    const idSanPham = parseInt(sanPham.querySelector('.so-luong-san-pham').id.replace('san-pham_', ''));
                    danhSachSanPham = danhSachSanPham.filter((sanPham) => sanPham.id !== idSanPham);
                    sanPham.remove();
                    capNhatTongTien();
                }
            });
        </script>
    </body>
</html>
